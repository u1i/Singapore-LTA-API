import json
import pycurl
from StringIO import StringIO

endpoint="http://datamall2.mytransport.sg/ltaodataservice/BusArrivalv2"

execfile("apikey.cfg")

# stops=[ "01012","01013","01019","01029"]

stops = [ "01012","01013","01019","01029","01039","01059","01109","01112","01113","01119","01121","01129","01139","01211","01219","01229","01231","01239","01311","01319","01329","01339","01341","01349","01411","01419","01421","01429","01511","01519","01521","01529","01541","01549","01559","01611","01619","01621","01629","01631","01639","02029","02049","02051","02061","02089","02099","02101","02111","02119","02141","02149","02151","02159","02161","02169","02171","02181","03011","03019","03021","03031","03041","03059","03071","03111","03129","03151","03217","03218","03222","03223","03239","03241","03331","03339","03341","03349","03369","03371","03381","03391","03411","03419","03421","03501","03509","03511","03519","03529","03539","04019","04029","04111","04121","04142","04143","04149","04151","04159","04167","04168","04179","04211","04219","04222","04223","04229","04239","04249","04251","04311","04321","04329","04331","04339","05009","05012","05013","05019","05022","05023","05029","05039","05049","05059","05069","05129","05131","05189","05199","05239","05241","05259","05269","05271","05319","05411","05419","05421","05429","05519","05521","05629","05631","05641","05649","05651","06011","06029","06031","06039","06049","06051","06069","06071","06081","06129","06131","06141","06149","06151","06159","06161","06169","06171","06189","07011","07021","07031","07111","07211","07221","07231","07241","07249","07319","07329","07331","07351","07359","07361","07369","07371","07379","07419","07517","07518","07529","07531","07539","07551","07561","07569","07571","07589","08011","08019","08031","08041","08057","08058","08069","08079","08111","08121","08137","08138","09011","09022","09023","09037","09038","09047","09048","09059","09111","09121","09131","09139","09141","09149","09159","09169","09179","09191","09212","09213","09219","10009","10011","10017","10018","10021","10041","10049","10051","10059","10061","10069","10071","10079","10081","10089","10091","10099","10101","10109","10111","10119","10121","10129","10131","10139","10141","10149","10151","10161","10169","10171","10179","10181","10189","10191","10199","10201","10209","10211","10219","10221","10229","10231","10239","10241","10249","10261","10269","10271","10279","10281","10289","10291","10299","10321","10329","10331","10339","10341","10349","10351","10359","10361","10369","10371","10379","10381","10389","10391","10399","10401","10409","10411","10419","10421","10429","10431","10439","10441","10449","10451","10459","10461","10469","10471","10479","10481","10489","10501","10519","10589","10599","10651","10659","11139","11531","11539","13011","13019","13021","13029","13031","13039","13041","13049","13051","13059","13062","13063","13069","13071","13079","13081","13089","13091","13099","13101","13109","13119","13121","13139","13141","13159","13169","13171","13179","13181","13189","13191","13199","13201","13209","13211","14009","14011","14019","14021","14029","14031","14039","14041","14049","14051","14059","14061","14069","14071","14081","14089","14101","14109","14119","14121","14129","14131","14139","14141","14151","14159","14161","14169","14191","14199","14201","14209","14219","14221","14229","14231","14239","14241","14249","14259","14269","14271","14279","14281","14291","14299","14309","14319","14329","14331","14339","14341","14349","14351","14359","14379","14381","14389","14391","14399","14471","14489","14491","14499","14519","14521","14529","40011","40019","40021","40029","40031","40039","40041","40049","40051","40059","40069","40071","40079","40081","40089","40101","40109","40111","40119","40121","40129","40171","40179","40181","40189","40191","40199","40201","40209","40211","40219","40221","40229","40271","40279","50011","50019","50021","50029","50031","50037","50038","50041","50049","50051","50059","50061","50069","50071","50079","50081","50089","50111","50119","50121","50129","50159","50161","50169","50171","50179","50189","50191","50199","50201","50209","50211","50221","50229","50231","50239","50241","50249","50251","50259","50261","50279","50301","50321","50331","50349","50351","50991","51011","51099","51109","52049","52099","52109","52119","52129","52401","52409","52411","52419","52451","52471","52479","52499","60011","60019","60021","60029","60031","60039","60051","60059","60061","60069","60099","60101","60119","60121","60139","60141","60159","60161","60191","60199","60221","60229","60241","60249","60251","80009","80011","80029","80031","80039","80049","80051","80069","80071","80089","80091","80101","80109","80111","80119","80141","80149","80151","80159","80161","80169","80171","80179","80181","80189","80191","80199","80211","80219","80229","80249","80251","80259","80269","80271","80279","80289","80291","80299","80301","80309","80311","80319","81011","81029","81081","81089","81161","81169","81171","81179","81181","81189","81231","90011","90019","90021","90029","90031","90039","90051","90059","90061","90069","90079","91041","91049","91051","91059","91061","91081","91089","91091","91099","91111" ]
for stop in stops:

	buffer = StringIO()
	c = pycurl.Curl()
	c.setopt(pycurl.HTTPHEADER, ['AccountKey: ' + AccountKey])
	c.setopt(c.URL, endpoint + "/?BusStopCode=" + str(stop))
	c.setopt(c.WRITEDATA, buffer)
	c.perform()
	c.close()
	
	body = buffer.getvalue()
	data = json.loads(body)

	for s in data["Services"]:
		l = s["NextBus"]["Load"]
		# if l != "SEA":
		print str(stop) + " " + str(s["ServiceNo"]) + " " +  str(l)
